# Org Coding Hours Action

This composite GitHub Action calculates coding hours across one or more repositories, aggregates the per‑contributor statistics, generates JSON reports, builds a simple KPI website, and publishes both the metrics and the site to dedicated branches. The action encapsulates the logic from the `Org Coding Hours` workflow in the LabVIEW icon editor project.

## Prerequisites

* Go **1.24** must be installed and available on the `PATH`.
* Python **3.x** is required for the helper scripts and tests.
When this action runs in a workflow, it installs Go and Python automatically. These prerequisites are only required when developing or testing locally.


## Inputs

| Name | Required | Default | Description |
|-----|---------|---------|-------------|
| `repos` | Yes | – | A space‑separated list of repositories in `owner/name` form. Each repository is cloned and processed by the `git‑hours` CLI. |
| `window_start` | No | – | Optional start date (`YYYY‑MM‑DD`) passed to `git‑hours -since` to limit the reporting window. |
| `metrics_branch` | No | `metrics` | The branch where the JSON reports are committed. |
| `pages_branch` | No | `gh-pages` | The branch where the generated KPI website is committed (enables GitHub Pages). |
| `git_hours_version` | No | `v0.1.2` | git-hours release tag to install and cache. |

## Outputs

| Name | Description |
|------|-------------|
| `aggregated_report` | Path to the aggregated JSON report generated by the action. |

In addition to this output, the action writes per-repository and aggregated JSON files into a `reports/` directory, builds a static site in `site/`, commits the reports to the `metrics_branch`, and commits the site to the `pages_branch`. The commit history on those branches serves as the record of your organization’s coding hours.

## Example workflow

**Important:** Set `permissions: contents: write` in your workflow so the action can push metrics and the KPI website. Ensure GitHub Pages is enabled for the `pages_branch`.
```yaml
name: Org Coding Hours Report

on:
  workflow_dispatch:
    inputs:
      repos:
        description: 'Space‑separated list of repositories'
        required: true
      window_start:
        description: 'Optional start date YYYY‑MM‑DD'
        required: false

permissions:
  contents: write

jobs:
  org-report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Org Coding Hours Action
        uses: ./org-coding-hours-action
        with:
          repos: ${{ github.event.inputs.repos }}
          window_start: ${{ github.event.inputs.window_start }}
```

This workflow triggers manually through the GitHub UI. When run, it computes coding hours across the specified repositories, writes JSON reports to the `metrics` branch, and publishes the KPI website to the `gh-pages` branch.

### Using in other repositories

To run the action from another repository, reference it by `OWNER/REPO` and a tag or commit:

```yaml
- name: Run Org Coding Hours Action
  uses: labview-community-ci-ci/org-coding-hours-action@v1
  with:
    repos: owner1/repo1 owner2/repo2
```

Replace `labview-community-ci-ci` with the organization that hosts this action. The action file lives at the repository root. Pinning to a release tag (e.g., `@v1`) or commit is recommended over `@latest` for reproducible results.
## Continuous Integration

The workflow at `.github/workflows/ci.yml` verifies the Python helper scripts and runs [actionlint](https://github.com/rhysd/actionlint) on every push and pull request. The `.github/workflows/release.yml` workflow performs the same checks and runs the unit tests. When a GitHub release is created it uploads the action files as release assets.

## Notes

* The action installs a specific version of `git‑hours` (controlled by the `git_hours_version` input) using Go 1.24 and executes a Python helper script.
* Both branches (`metrics_branch` and `pages_branch`) are created automatically if they do not exist. Subsequent runs will update the existing branches without force‑pushing unless a non‑fast‑forward update is required.

## Development

Modify the Python helper scripts in `scripts/` as needed and run the unit tests locally:

```bash
pip install -r requirements-dev.txt  # or: pip install pytest
pytest
```

Create a Git tag (`vX.Y.Z`) when you are ready to publish a new release. The release workflow will package the action files and upload them as assets.

## License

This project is licensed under the [MIT License](LICENSE).
